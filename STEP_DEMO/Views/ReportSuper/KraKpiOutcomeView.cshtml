@model List<KraKpiOutcomeModel>

<head>
    <link rel="stylesheet" type="text/css" href="~/Content/css/CustomStyles.css">
</head>

<a href="@Url.Action("ViewEmpList", "DeptHead")" class="btn btn-primary" style="text-decoration: none;">
    <span>Search Again</span>
</a>
<br />
<br />
@*@if (!string.IsNullOrEmpty(TempData["SuccessMessage"] as string))
    {
        <div class="alert alert-success" role="alert">
            @TempData["SuccessMessage"]
        </div>
    }

    @if (!string.IsNullOrEmpty(TempData["ErrorMessage"] as string))
    {
        <div class="alert alert-danger" role="alert">
            @TempData["ErrorMessage"]
        </div>
    }*@
<br />

@if (Model != null && Model.Count > 0)
{
    <div class="table-responsive">
        <form method="post" action="@Url.Action("UpdateMarks", "ReportSuper")">
            <table class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>KRA</th>
                        <th>KPI</th>
                        <th>Outcome</th>
                        <th>Performance Marks</th>
                        <th>Average</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var kraGroup in Model.GroupBy(item => item.KRA))
                    {
                        var kra = kraGroup.Key;
                        var kpis = kraGroup.ToList();
                        var first = true;

                        foreach (var item in kpis)
                        {
                    <tr>
                        @if (first)
                        {
                            <td rowspan="@kpis.Count">@kra</td>
                            first = false;
                        }
                        <td>@item.KPI</td>
                        <td>@item.Outcome</td>
                        <td>
                            <input type="hidden" name="outcomes" value="@item.Outcome" />
                            <select name="marks[@item.Outcome]" onchange="calculateAverage(this, '@item.KRA')">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                            </select>
                        </td>
                          <td>
                                    <input type="text" id="average-@item.Outcome" disabled />
                                </td>

                    </tr>
                        }
                    }
                </tbody>
            </table>
            <input type="submit" value="Save Marks" />
        </form>
    </div>
}
else
{
    <div class="alert alert-danger" role="alert">
        No data found
    </div>
}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>


    function calculateAverage(selectElement, kra) {
        var totalMarks = 0;
        var rowCount = 0;
        var marksCells = document.querySelectorAll('[name^="marks[' + kra + ']"]');

    }

</script>