@model STEP_DEMO.Models.OutcomeViewModel

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Outcome</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        table {
            border-collapse: collapse;
            width: 100%;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }

        th {
            background-color: #f2f2f2;
        }

        tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        input[type="number"] {
            width: 40px;
        }

        .submit-btn {
            width: auto;
            padding: 10px 20px;
            font-size: 16px;
        }

        input#average {
            width: 80px;
        }

        .error {
            color: red;
            font-size: 12px;
        }


        .custom-select {
            display: inline-block;
            width: 100%;
            height: calc(1.5em + 1.25rem + 2px);
            padding: 0.375rem 1.75rem 0.375rem 0.75rem;
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: #495057;
            vertical-align: middle;
            background: #fff url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'><path d='M4 6l4-4H0z'/></svg>") no-repeat right 0.75rem center;
            background-size: 8px 10px;
            border: 1px solid #ced4da;
            border-radius: 0.25rem;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }

            .custom-select:disabled {
                background-color: #e9ecef;
                opacity: 1;
            }
            .custom-select option {
                font-size: 1rem; 
            }            
            .custom-select {
                font-size: 0.9rem; 
            }
        .submit-btn2 {
            float: right;
            font-size: 14px;
        }

    </style>
</head>
<body>
    @using (Html.BeginForm("OutcomeNew", "Home", FormMethod.Post, new { id = "outcomeForm" }))
    {
        <div class="form-group">
            <label for="kraDropdown">Select KRA:</label>
            <select id="kraDropdown" class="custom-select">
                <option value="">Select KRA</option>
                @foreach (var kvp in ViewBag.KraKpiData)
                {
                    <option value="@kvp.Key">@kvp.Key</option>
                }
            </select>
        </div>

        <div class="form-group">
            <label for="kpiDropdown">Select KPI:</label>
            <select id="kpiDropdown" class="custom-select" disabled>
                <option value="">Select KPI</option>
            </select>
        </div>
        <button id="saveBtn" class="btn btn-primary">Save</button>
        <br /><br />
        <table id="selectedItemsTable" class="table">
            <thead>
                <tr>
                    <th>Selected KRA</th>
                    <th>Selected KPI</th>
                    <th>KPI Outcome</th>
                </tr>

            </thead>
            <tbody>
                <!-- Selected items will be displayed here -->
            </tbody>
        </table>

        <div class="form-group">
            <input type="hidden" name="regId" value="@Session["RegID"]" />
            <br />
            <button type="submit" class="btn btn-primary submit-btn2">Submit</button>
        </div>
    }

<script>
    document.getElementById("saveBtn").addEventListener("click", function () {
        var selectedKRA = document.getElementById("kraDropdown").value;
        var selectedKPI = document.getElementById("kpiDropdown").value;

        if (selectedKRA && selectedKPI) {
            var tableBody = document.querySelector("#selectedItemsTable tbody");
            var newRow = document.createElement("tr");
            newRow.innerHTML = `
            <td>${selectedKRA}</td>
            <td>${selectedKPI}</td>
            <td><input type="text" class="form-control" name="KPI_OUTCOME[]" placeholder="Enter KPI Outcome" /></td>
        `;
            tableBody.appendChild(newRow);

            // reset dropdowns
            document.getElementById("kraDropdown").value = "";
            document.getElementById("kpiDropdown").value = "";
            document.getElementById("kpiDropdown").setAttribute("disabled", true);
        } else {
            alert("Please select both KRA and KPI");
        }
    });

   @* document.getElementById("kraDropdown").addEventListener("change", function () {
        var selectedKRA = this.value;
        var kpiDropdown = document.getElementById("kpiDropdown");
        kpiDropdown.innerHTML = "";

        if (selectedKRA) {
            var kpiOptions = "";
            var selectedKRAData = @Html.Raw(Json.Encode(ViewBag.KraKpiData));

            selectedKRAData.forEach(function (item) {
                if (item.Key === selectedKRA) {
                    item.Value.forEach(function (kpi) {
                        kpiOptions += `<option value="${kpi}">${kpi}</option>`;
                    });
                }
            });

            if (kpiOptions) {
                kpiDropdown.innerHTML = kpiOptions;
                kpiDropdown.removeAttribute("disabled");
            } else {
                kpiDropdown.innerHTML = '<option value="">No KPIs available</option>';
                kpiDropdown.setAttribute("disabled", true);
            }
        } else {
            kpiDropdown.innerHTML = '<option value="">Select KPI</option>';
            kpiDropdown.setAttribute("disabled", true);
        }
    });*@

    document.getElementById("kraDropdown").addEventListener("change", function () {
    var selectedKRA = this.value;
        var kpiDropdown = document.getElementById("kpiDropdown");
        var selectedKRA = this.value;
        console.log(selectedKRA);
    kpiDropdown.innerHTML = "";

    if (selectedKRA) {
        var kpiOptions = "";
        var selectedKRAData = @Html.Raw(Json.Encode(ViewBag.KraKpiData));

        selectedKRAData.forEach(function (item) {
            if (item.Key === selectedKRA) {
                item.Value.forEach(function (kpi) {
                    kpiOptions += `<option value="${kpi}">${kpi}</option>`;
                });
            }
        });

        if (kpiOptions) {
            kpiDropdown.innerHTML = kpiOptions;
            kpiDropdown.removeAttribute("disabled");
        } else {
            kpiDropdown.innerHTML = '<option value="">No KPIs available</option>';
            kpiDropdown.setAttribute("disabled", true);
        }
    } else {
        kpiDropdown.innerHTML = '<option value="">Select KPI</option>';
        kpiDropdown.setAttribute("disabled", true);
    }
});


    document.addEventListener("DOMContentLoaded", function () {
        // Function to handle Save button click
        document.getElementById("saveBtn").addEventListener("click", function () {
            var selectedKRA = document.getElementById("kraDropdown").value;
            var selectedKPI = document.getElementById("kpiDropdown").value;

            if (selectedKRA && selectedKPI) {
                var tableBody = document.querySelector("#selectedItemsTable tbody");
                var newRow = document.createElement("tr");
                newRow.innerHTML = `
                <td>${selectedKRA}</td>
                <td>${selectedKPI}</td>
                <td><input type="text" class="form-control kpiOutcomeInput" name="KPI_OUTCOME[]" placeholder="Enter KPI Outcome" /></td>
            `;
                tableBody.appendChild(newRow);

                // reset dropdowns
                document.getElementById("kraDropdown").value = "";
                document.getElementById("kpiDropdown").value = "";
                document.getElementById("kpiDropdown").setAttribute("disabled", true);
            } else {

            }
        });

        // Function to handle form submission
        document.getElementById("outcomeForm").addEventListener("submit", function (event) {
            event.preventDefault();
            var formData = [];
            var rows = document.querySelectorAll("#selectedItemsTable tbody tr");
            rows.forEach(function (row) {
                // Extract data from the row
                var selectedKRA = row.cells[0].innerText;
                var selectedKPI = row.cells[1].innerText;
                var kpiOutcome = row.querySelector(".kpiOutcomeInput").value;

                // Create an object representing the row of data
                var rowData = {
                    KRA: selectedKRA,
                    KPI: selectedKPI,
                    KPI_OUTCOME: kpiOutcome
                };

                formData.push(rowData);
            });

            var formDataInput = document.createElement("input");
            formDataInput.type = "hidden";
            formDataInput.name = "formData";
            formDataInput.value = JSON.stringify(formData);
            this.appendChild(formDataInput);

            // Submit the form
            this.submit();
        });
    });

</script>

</body>
</html>
